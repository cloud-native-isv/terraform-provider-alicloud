# Feature Detail: Tablestore VCU Instance Support

**Feature ID**: 007  
**Name**: Tablestore VCU Instance Support  
**Description**: Support configuration of Tablestore instances using the VCU sizing model and elastic limits.  
**Status**: Completed  
**Created**: 2026-01-06  
**Last Updated**: 2026-01-07

## Overview

This feature enables users to provision Alibaba Cloud Tablestore (OTS) instances using the VCU (Virtual Compute Unit) pricing model. This model offers better elasticity and serverless-style billing compared to traditional capacity units. The update includes support for setting the instance specification to "VCU" and configuring the `elastic_vcu_upper_limit`.

## Latest Review

**Date**: 2026-01-07

The feature is fully implemented and verified. The Terraform provider can now successfully create and manage VCU-based Tablestore instances.

**Key Capabilities**:
- **VCU Creation**: Support for `instance_specification = "VCU"`.
- **Limit Configuration**: Optional configuration of `elastic_vcu_upper_limit` (float).
- **In-Place Updates**: Modification of `elastic_vcu_upper_limit` updates the instance without destruction.

**Important Constraints & Notes**:
- **SDK Dependency**: The implementation initially relied on `cws-lib-go`. A patch was applied to the local SDK definitions to fix a missing `InstanceName` field in the `CreateVCUInstanceRequest` struct.
- **Idempotency**: Verified via `terraform plan` to show no diffs after successful creation.

## User Value

Users can now leverage the cost-efficiency and flexibility of Tablestore VCU model directly through Terraform, managing their compute limits dynamically as infrastructure code.

## Key Changes

1.  **Resource Schema**:
    - Validated `"VCU"` as a valid `instance_specification`.
    - Added/Verified `elastic_vcu_upper_limit` as a Top-Level Argument.

2.  **Service Layer**:
    - Ensured `CreateInstance` and `UpdateInstanceElasticVCUUpperLimit` are correctly invoked via the API wrapper.

3.  **SDK Fix**:
    - Patched `alicloud_tablestore_instance_utils.go` and `client.go` to support `InstanceName` in VCU creation requests.

## Future Evolution Suggestions

-   **SDK Upgrade**: Prioritize updating the `cws-lib-go` or Alibaba Cloud SDK dependency to a version that officially supports `CreateVCUInstanceRequest.InstanceName` to remove the local patch.
-   **Negative Testing**: Add acceptance tests that attempt to set `elastic_vcu_upper_limit` on non-VCU instances to verify the API/Provider returns a clear error or warning.
-   **Quota Monitoring**: Consider exposing `vcu_quota` or other read-only VCU metrics if the API provides them, to assist users in monitoring their limits.

## Artifacts

-   **Specification**: [.specify/specs/007-ots-vcu-support/spec.md](../../specs/007-ots-vcu-support/spec.md)
-   **Plan**: [.specify/specs/007-ots-vcu-support/plan.md](../../specs/007-ots-vcu-support/plan.md)
-   **Tasks**: [.specify/specs/007-ots-vcu-support/tasks.md](../../specs/007-ots-vcu-support/tasks.md)
-   **Review**: [.specify/specs/007-ots-vcu-support/review.md](../../specs/007-ots-vcu-support/review.md)
-   **Quickstart**: [.specify/specs/007-ots-vcu-support/quickstart.md](../../specs/007-ots-vcu-support/quickstart.md)
